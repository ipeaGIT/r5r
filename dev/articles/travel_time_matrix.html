<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Travel time matrices • r5r</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Travel time matrices">
<meta name="robots" content="noindex">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">r5r</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">2.2.0999999</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/r5r.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/accessibility.html">Accessibility</a></li>
    <li><a class="dropdown-item" href="../articles/detailed_itineraries.html">Trip planning with detailed_itineraries()</a></li>
    <li><a class="dropdown-item" href="../articles/faq.html">FAQ - Frequently Asked Questions</a></li>
    <li><a class="dropdown-item" href="../articles/fare_structure.html">Accounting for monetary costs</a></li>
    <li><a class="dropdown-item" href="../articles/isochrones.html">Isochrones</a></li>
    <li><a class="dropdown-item" href="../articles/modify_osm_car_speeds.html">Modify OSM car speeds</a></li>
    <li><a class="dropdown-item" href="../articles/pareto_frontier.html">Trade-offs between travel time and monetary cost</a></li>
    <li><a class="dropdown-item" href="../articles/time_window.html">Using the time_window parameter</a></li>
    <li><a class="dropdown-item" href="../articles/travel_time_matrix.html">Travel time matrices</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ipeaGIT/r5r/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Travel time matrices</h1>
            
            <h4 data-toc-skip class="date">2025-07-03</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ipeaGIT/r5r/blob/master/vignettes/travel_time_matrix.Rmd" class="external-link"><code>vignettes/travel_time_matrix.Rmd</code></a></small>
      <div class="d-none name"><code>travel_time_matrix.Rmd</code></div>
    </div>

    
        <div class="abstract">
      <p class="abstract">Abstract</p>
      This vignette shows how to use the travel_time_matrix() and
      expanded_travel_time_matrix() functions in r5r.
    </div>
    
<div class="section level2">
<h2 id="introduction">1. Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Some of the most common tasks in transport planning and modeling
involve require having good quality data with travel time estimates
between origins and destinations. <code>R5</code> is incredibly fast in
generating realistic door-to-door travel time estimates in multimodal
transport systems.</p>
<p>The <code>r5r</code> package has two functions that allow users to
leverage the computing power of <code>R5</code>: -
<code><a href="../reference/travel_time_matrix.html">travel_time_matrix()</a></code> -
<code><a href="../reference/expanded_travel_time_matrix.html">expanded_travel_time_matrix()</a></code> -
<code><a href="../reference/arrival_travel_time_matrix.html">arrival_travel_time_matrix()</a></code></p>
<p>This vignette shows a reproducible example to explain how these two
functions work and the differences between them.</p>
</div>
<div class="section level2">
<h2 id="build-routable-transport-network-with-build_network">2. Build routable transport network with
<code>build_network()</code><a class="anchor" aria-label="anchor" href="#build-routable-transport-network-with-build_network"></a>
</h2>
<p>First, let’s build the multimodal transport network we’ll be using in
this vignette. In this example we’ll be using the a sample data set for
the city of Porto Alegre (Brazil) included in <code>r5r</code>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># increase Java memory</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>java.parameters <span class="op">=</span> <span class="st">"-Xmx2G"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># load libraries</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ipeaGIT/r5r" class="external-link">r5r</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># build a routable transport network with r5r</span></span>
<span><span class="va">data_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/poa"</span>, package <span class="op">=</span> <span class="st">"r5r"</span><span class="op">)</span></span>
<span><span class="va">r5r_network</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/build_network.html">build_network</a></span><span class="op">(</span><span class="va">data_path</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># routing inputs</span></span>
<span><span class="va">mode</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'walk'</span>, <span class="st">'transit'</span><span class="op">)</span></span>
<span><span class="va">max_trip_duration</span> <span class="op">&lt;-</span> <span class="fl">60</span> <span class="co"># minutes</span></span>
<span></span>
<span><span class="co"># departure time</span></span>
<span><span class="va">departure_datetime</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html" class="external-link">as.POSIXct</a></span><span class="op">(</span><span class="st">"13-05-2019 14:00:00"</span>, </span>
<span>                                 format <span class="op">=</span> <span class="st">"%d-%m-%Y %H:%M:%S"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># load origin/destination points</span></span>
<span><span class="va">points</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/fread.html" class="external-link">fread</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">data_path</span>, <span class="st">"poa_points_of_interest.csv"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="the-travel_time_matrix-function">3. The <code>travel_time_matrix()</code> function<a class="anchor" aria-label="anchor" href="#the-travel_time_matrix-function"></a>
</h2>
<p>The <code><a href="../reference/travel_time_matrix.html">travel_time_matrix()</a></code> function provides a simple and
really fast way to calculate the travel time between all possible origin
destination pairs at a given departure time using a given transport
mode.</p>
<p>The user can also customize many parameters such as: -
<code>max_trip_duration</code>: maximum trip duration -
<code>max_rides</code>: maximum number of transfer in the public
transport system - <code>max_walk_time</code> and
<code>max_bike_time</code>: maximum walking or cycling time to and from
public transport - <code>walk_speed</code> and <code>bike_speed</code>:
maximum walking or cycling speed - <code>max_fare</code>: maximum
monetary cost in public transport. <a href="https://ipeagit.github.io/r5r/articles/fare_structure.html">See
this vignette</a>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># estimate travel time matrix</span></span>
<span><span class="va">ttm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/travel_time_matrix.html">travel_time_matrix</a></span><span class="op">(</span><span class="va">r5r_network</span>,   </span>
<span>                          origins <span class="op">=</span> <span class="va">points</span>,</span>
<span>                          destinations <span class="op">=</span> <span class="va">points</span>,    </span>
<span>                          mode <span class="op">=</span> <span class="va">mode</span>,</span>
<span>                          max_trip_duration <span class="op">=</span> <span class="va">max_trip_duration</span>,</span>
<span>                          departure_datetime <span class="op">=</span> <span class="va">departure_datetime</span> <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">ttm</span>, n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt;           from_id                     to_id travel_time_p50</span></span>
<span><span class="co">#&gt;            &lt;char&gt;                    &lt;char&gt;           &lt;int&gt;</span></span>
<span><span class="co">#&gt;  1: public_market             public_market               0</span></span>
<span><span class="co">#&gt;  2: public_market       bus_central_station              14</span></span>
<span><span class="co">#&gt;  3: public_market          gasometer_museum              12</span></span>
<span><span class="co">#&gt;  4: public_market       santa_casa_hospital              15</span></span>
<span><span class="co">#&gt;  5: public_market                  townhall               3</span></span>
<span><span class="co">#&gt;  6: public_market           piratini_palace              17</span></span>
<span><span class="co">#&gt;  7: public_market    metropolitan_cathedral              17</span></span>
<span><span class="co">#&gt;  8: public_market          farroupilha_park              18</span></span>
<span><span class="co">#&gt;  9: public_market moinhos_de_vento_hospital              20</span></span>
<span><span class="co">#&gt; 10: public_market          farrapos_station              21</span></span></code></pre></div>
<p>Now remember that travel time estimates can vary significantly across
the day because of variations in public transport service levels. In
order to account for this, you might want to calculate multiple travel
time matrices departing at different times.</p>
<p>This can be done very efficiently by using the
<code>time_window</code> and <code>percentile</code> parameters in the
<code><a href="../reference/travel_time_matrix.html">travel_time_matrix()</a></code> function. When these parameters are
set, R<sup>5</sup> will automatically compute multiple travel times
estimates considering multiple departures per minute within the
<code>time_window</code> selected by the user. <a href="https://ipeagit.github.io/r5r/articles/time_window.html">More
information about this functionality can found in this vignette</a>.</p>
</div>
<div class="section level2">
<h2 id="the-expanded_travel_time_matrix-function">4. The <code>expanded_travel_time_matrix()</code> function<a class="anchor" aria-label="anchor" href="#the-expanded_travel_time_matrix-function"></a>
</h2>
<p>Sometimes, we want to know more than simply the total travel time
from A to B. This is when the <code><a href="../reference/expanded_travel_time_matrix.html">expanded_travel_time_matrix()</a></code>
function comes in. By default, the output of this function will also
tell which public transport routes were taken between each origin
destination pair.</p>
<p>Nonetheless, you may set the parameter <code>breakdown = TRUE</code>
to gather much more info for each trip. In this case,
<code><a href="../reference/expanded_travel_time_matrix.html">expanded_travel_time_matrix()</a></code> will tell the number of
transfers used to complete each trip and their total access, waiting,
in-vehicle and transfer times. Please note that setting
<code>breakdown = TRUE</code> can make the function slower for large
data sets.</p>
<p><em>A general call to expanded_travel_time_matrix()</em></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ettm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/expanded_travel_time_matrix.html">expanded_travel_time_matrix</a></span><span class="op">(</span><span class="va">r5r_network</span>,   </span>
<span>                                    origins <span class="op">=</span> <span class="va">points</span>,</span>
<span>                                    destinations <span class="op">=</span> <span class="va">points</span>,    </span>
<span>                                    mode <span class="op">=</span> <span class="va">mode</span>,</span>
<span>                                    max_trip_duration <span class="op">=</span> <span class="va">max_trip_duration</span>,</span>
<span>                                    departure_datetime <span class="op">=</span> <span class="va">departure_datetime</span> <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">ettm</span>, n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt;           from_id         to_id departure_time draw_number routes total_time</span></span>
<span><span class="co">#&gt;            &lt;char&gt;        &lt;char&gt;         &lt;char&gt;       &lt;int&gt; &lt;char&gt;      &lt;num&gt;</span></span>
<span><span class="co">#&gt;  1: public_market public_market       14:00:00           1 [WALK]          0</span></span>
<span><span class="co">#&gt;  2: public_market public_market       14:01:00           1 [WALK]          0</span></span>
<span><span class="co">#&gt;  3: public_market public_market       14:02:00           1 [WALK]          0</span></span>
<span><span class="co">#&gt;  4: public_market public_market       14:03:00           1 [WALK]          0</span></span>
<span><span class="co">#&gt;  5: public_market public_market       14:04:00           1 [WALK]          0</span></span>
<span><span class="co">#&gt;  6: public_market public_market       14:05:00           1 [WALK]          0</span></span>
<span><span class="co">#&gt;  7: public_market public_market       14:06:00           1 [WALK]          0</span></span>
<span><span class="co">#&gt;  8: public_market public_market       14:07:00           1 [WALK]          0</span></span>
<span><span class="co">#&gt;  9: public_market public_market       14:08:00           1 [WALK]          0</span></span>
<span><span class="co">#&gt; 10: public_market public_market       14:09:00           1 [WALK]          0</span></span></code></pre></div>
<p><em>Calling expanded_travel_time_matrix() with
<code>breakdown = TRUE</code></em></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ettm2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/expanded_travel_time_matrix.html">expanded_travel_time_matrix</a></span><span class="op">(</span><span class="va">r5r_network</span>,   </span>
<span>                                    origins <span class="op">=</span> <span class="va">points</span>,</span>
<span>                                    destinations <span class="op">=</span> <span class="va">points</span>,    </span>
<span>                                    mode <span class="op">=</span> <span class="va">mode</span>,</span>
<span>                                    max_trip_duration <span class="op">=</span> <span class="va">max_trip_duration</span>,</span>
<span>                                    departure_datetime <span class="op">=</span> <span class="va">departure_datetime</span>,</span>
<span>                                    breakdown <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">ettm2</span>, n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt;           from_id         to_id departure_time draw_number access_time</span></span>
<span><span class="co">#&gt;            &lt;char&gt;        &lt;char&gt;         &lt;char&gt;       &lt;int&gt;       &lt;num&gt;</span></span>
<span><span class="co">#&gt;  1: public_market public_market       14:00:00           1           0</span></span>
<span><span class="co">#&gt;  2: public_market public_market       14:01:00           1           0</span></span>
<span><span class="co">#&gt;  3: public_market public_market       14:02:00           1           0</span></span>
<span><span class="co">#&gt;  4: public_market public_market       14:03:00           1           0</span></span>
<span><span class="co">#&gt;  5: public_market public_market       14:04:00           1           0</span></span>
<span><span class="co">#&gt;  6: public_market public_market       14:05:00           1           0</span></span>
<span><span class="co">#&gt;  7: public_market public_market       14:06:00           1           0</span></span>
<span><span class="co">#&gt;  8: public_market public_market       14:07:00           1           0</span></span>
<span><span class="co">#&gt;  9: public_market public_market       14:08:00           1           0</span></span>
<span><span class="co">#&gt; 10: public_market public_market       14:09:00           1           0</span></span>
<span><span class="co">#&gt;     wait_time ride_time transfer_time egress_time routes n_rides total_time</span></span>
<span><span class="co">#&gt;         &lt;num&gt;     &lt;num&gt;         &lt;num&gt;       &lt;num&gt; &lt;char&gt;   &lt;int&gt;      &lt;num&gt;</span></span>
<span><span class="co">#&gt;  1:         0         0             0           0 [WALK]       0          0</span></span>
<span><span class="co">#&gt;  2:         0         0             0           0 [WALK]       0          0</span></span>
<span><span class="co">#&gt;  3:         0         0             0           0 [WALK]       0          0</span></span>
<span><span class="co">#&gt;  4:         0         0             0           0 [WALK]       0          0</span></span>
<span><span class="co">#&gt;  5:         0         0             0           0 [WALK]       0          0</span></span>
<span><span class="co">#&gt;  6:         0         0             0           0 [WALK]       0          0</span></span>
<span><span class="co">#&gt;  7:         0         0             0           0 [WALK]       0          0</span></span>
<span><span class="co">#&gt;  8:         0         0             0           0 [WALK]       0          0</span></span>
<span><span class="co">#&gt;  9:         0         0             0           0 [WALK]       0          0</span></span>
<span><span class="co">#&gt; 10:         0         0             0           0 [WALK]       0          0</span></span></code></pre></div>
<p>You will notice in the documentation that the
<code><a href="../reference/expanded_travel_time_matrix.html">expanded_travel_time_matrix()</a></code> also has a
<code>time_window</code> parameter. In this case, though, when the user
sets a <code>time_window</code> value, the
<code><a href="../reference/expanded_travel_time_matrix.html">expanded_travel_time_matrix()</a></code> will return the fastest route
alternative departing each minute within the specified time window.
Please note this function can be very memory intensive for large data
sets and time windows.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ettm_window</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/expanded_travel_time_matrix.html">expanded_travel_time_matrix</a></span><span class="op">(</span><span class="va">r5r_network</span>,   </span>
<span>                                           origins <span class="op">=</span> <span class="va">points</span>,</span>
<span>                                           destinations <span class="op">=</span> <span class="va">points</span>,    </span>
<span>                                           mode <span class="op">=</span> <span class="va">mode</span>,</span>
<span>                                           max_trip_duration <span class="op">=</span> <span class="va">max_trip_duration</span>,</span>
<span>                                           departure_datetime <span class="op">=</span> <span class="va">departure_datetime</span>,</span>
<span>                                           breakdown <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                           time_window <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ettm_window</span><span class="op">[</span><span class="fl">15</span><span class="op">:</span><span class="fl">25</span>,<span class="op">]</span></span>
<span><span class="co">#&gt;           from_id               to_id departure_time draw_number access_time</span></span>
<span><span class="co">#&gt;            &lt;char&gt;              &lt;char&gt;         &lt;char&gt;       &lt;int&gt;       &lt;num&gt;</span></span>
<span><span class="co">#&gt;  1: public_market bus_central_station       14:04:00           1         1.5</span></span>
<span><span class="co">#&gt;  2: public_market bus_central_station       14:05:00           1         4.8</span></span>
<span><span class="co">#&gt;  3: public_market bus_central_station       14:06:00           1         4.1</span></span>
<span><span class="co">#&gt;  4: public_market bus_central_station       14:07:00           1         4.4</span></span>
<span><span class="co">#&gt;  5: public_market bus_central_station       14:08:00           1         2.3</span></span>
<span><span class="co">#&gt;  6: public_market bus_central_station       14:09:00           1         2.3</span></span>
<span><span class="co">#&gt;  7: public_market    gasometer_museum       14:00:00           1         2.9</span></span>
<span><span class="co">#&gt;  8: public_market    gasometer_museum       14:01:00           1         6.0</span></span>
<span><span class="co">#&gt;  9: public_market    gasometer_museum       14:02:00           1         6.0</span></span>
<span><span class="co">#&gt; 10: public_market    gasometer_museum       14:03:00           1         3.5</span></span>
<span><span class="co">#&gt; 11: public_market    gasometer_museum       14:04:00           1         3.5</span></span>
<span><span class="co">#&gt;     wait_time ride_time transfer_time egress_time routes n_rides total_time</span></span>
<span><span class="co">#&gt;         &lt;num&gt;     &lt;num&gt;         &lt;num&gt;       &lt;num&gt; &lt;char&gt;   &lt;int&gt;      &lt;num&gt;</span></span>
<span><span class="co">#&gt;  1:       1.5       3.5             0         6.7    525       1       13.2</span></span>
<span><span class="co">#&gt;  2:       1.2       1.6             0         6.2 LINHA1       1       13.8</span></span>
<span><span class="co">#&gt;  3:       1.9       2.0             0         6.7    495       1       14.7</span></span>
<span><span class="co">#&gt;  4:       1.6       2.0             0         6.7    493       1       14.7</span></span>
<span><span class="co">#&gt;  5:       4.7       1.1             0         7.4    D72       1       15.5</span></span>
<span><span class="co">#&gt;  6:       3.7       1.1             0         7.4    D72       1       14.5</span></span>
<span><span class="co">#&gt;  7:       1.1       4.5             0         1.8   2821       1       10.3</span></span>
<span><span class="co">#&gt;  8:       3.0       4.3             0         1.8    346       1       15.1</span></span>
<span><span class="co">#&gt;  9:       2.0       4.3             0         1.8    346       1       14.1</span></span>
<span><span class="co">#&gt; 10:       3.5       4.9             0         1.8    244       1       13.7</span></span>
<span><span class="co">#&gt; 11:       2.5       4.9             0         1.8    244       1       12.7</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="the-arrival_travel_time_matrix-function">4. The <code>arrival_travel_time_matrix()</code> function<a class="anchor" aria-label="anchor" href="#the-arrival_travel_time_matrix-function"></a>
</h2>
<p>Both of the functions <code><a href="../reference/travel_time_matrix.html">travel_time_matrix()</a></code> and
<code><a href="../reference/expanded_travel_time_matrix.html">expanded_travel_time_matrix()</a></code> consider a
<strong>departure</strong> time set by the user. In some cases, though,
you might need to calculate travel times considering an <strong>arrival
time</strong>. For such cases, you can use
<code><a href="../reference/arrival_travel_time_matrix.html">arrival_travel_time_matrix()</a></code>. In this function, you need to
set the latest arrival time desired and a maximum trip duration. The
function returns the travel time of the trip with the latest departure
time that arrives before the arrival time.</p>
<p>This function is useful when modeling user behavior in situations
where arriving by a specific time is important, such as getting to work
or school for a set start time (e.g., 9 a.m.). In these scenarios, it is
often most convenient for a person to take the latest possible departure
that still ensures arrival before their required start time, rather than
choosing the trip with the shortest travel time but arriving much
earlier and waiting unnecessarily at the destination.</p>
<p>Note that the output of this function includes more information with
additional columns, like in the
<code><a href="../reference/expanded_travel_time_matrix.html">expanded_travel_time_matrix()</a></code> function (you can also use
<code>breakdown = TRUE</code>).</p>
<p><em>A general call to arrival_travel_time_matrix()</em></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">arrival_datetime</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html" class="external-link">as.POSIXct</a></span><span class="op">(</span></span>
<span> <span class="st">"13-05-2019 14:00:00"</span>,</span>
<span> format <span class="op">=</span> <span class="st">"%d-%m-%Y %H:%M:%S"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">arrival_ttm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/arrival_travel_time_matrix.html">arrival_travel_time_matrix</a></span><span class="op">(</span></span>
<span>  <span class="va">r5r_network</span>,</span>
<span>  origins <span class="op">=</span> <span class="va">points</span>,</span>
<span>  destinations <span class="op">=</span> <span class="va">points</span>,</span>
<span>  mode <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"WALK"</span>, <span class="st">"TRANSIT"</span><span class="op">)</span>,</span>
<span>  arrival_datetime <span class="op">=</span> <span class="va">arrival_datetime</span>,</span>
<span>  max_trip_duration <span class="op">=</span> <span class="fl">60</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">arrival_ttm</span>, n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt;           from_id                     to_id departure_time draw_number  routes</span></span>
<span><span class="co">#&gt;            &lt;char&gt;                    &lt;char&gt;         &lt;char&gt;       &lt;int&gt;  &lt;char&gt;</span></span>
<span><span class="co">#&gt;  1: public_market             public_market       13:59:00           1  [WALK]</span></span>
<span><span class="co">#&gt;  2: public_market       bus_central_station       13:45:00           1  LINHA1</span></span>
<span><span class="co">#&gt;  3: public_market          gasometer_museum       13:45:00           1    2441</span></span>
<span><span class="co">#&gt;  4: public_market       santa_casa_hospital       13:44:00           1  [WALK]</span></span>
<span><span class="co">#&gt;  5: public_market                  townhall       13:56:00           1  [WALK]</span></span>
<span><span class="co">#&gt;  6: public_market           piratini_palace       13:42:00           1  [WALK]</span></span>
<span><span class="co">#&gt;  7: public_market    metropolitan_cathedral       13:42:00           1  [WALK]</span></span>
<span><span class="co">#&gt;  8: public_market          farroupilha_park       13:40:00           1     R41</span></span>
<span><span class="co">#&gt;  9: public_market moinhos_de_vento_hospital       13:36:00           1 731|637</span></span>
<span><span class="co">#&gt; 10: public_market          farrapos_station       13:36:00           1     731</span></span>
<span><span class="co">#&gt;     total_time</span></span>
<span><span class="co">#&gt;          &lt;num&gt;</span></span>
<span><span class="co">#&gt;  1:        0.0</span></span>
<span><span class="co">#&gt;  2:       13.8</span></span>
<span><span class="co">#&gt;  3:       11.7</span></span>
<span><span class="co">#&gt;  4:       15.3</span></span>
<span><span class="co">#&gt;  5:        3.5</span></span>
<span><span class="co">#&gt;  6:       17.3</span></span>
<span><span class="co">#&gt;  7:       17.9</span></span>
<span><span class="co">#&gt;  8:       16.5</span></span>
<span><span class="co">#&gt;  9:       20.3</span></span>
<span><span class="co">#&gt; 10:       21.4</span></span></code></pre></div>
<div class="section level4">
<h4 id="cleaning-up-after-usage">Cleaning up after usage<a class="anchor" aria-label="anchor" href="#cleaning-up-after-usage"></a>
</h4>
<p><code>r5r</code> objects are still allocated to any amount of memory
previously set after they are done with their calculations. In order to
remove an existing <code>r5r</code> object and reallocate the memory it
had been using, we use the <code>stop_r5</code> function followed by a
call to Java’s garbage collector, as follows:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">r5r</span><span class="fu">::</span><span class="fu"><a href="../reference/stop_r5.html">stop_r5</a></span><span class="op">(</span><span class="va">r5r_network</span><span class="op">)</span></span>
<span><span class="fu">rJava</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rJava/man/jgc.html" class="external-link">.jgc</a></span><span class="op">(</span>R.gc <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>If you have any suggestions or want to report an error, please visit
<a href="https://github.com/ipeaGIT/r5r" class="external-link">the package GitHub
page</a>.</p>
</div>
<div class="section level3">
<h3 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h3>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Marcus Saraiva, Rafael H. M. Pereira, Daniel Herszenhut, Alex Magnus, Carlos Kaue Vieira Braga, Matthew Wigginton Bhagat-Conway, Ipea - Institute for Applied Economic Research, Department of Geography &amp; Planning, University of Toronto.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
