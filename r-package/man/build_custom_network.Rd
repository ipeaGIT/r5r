% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/build_custom_network.R
\name{build_custom_network}
\alias{build_custom_network}
\title{Create a custom transport network used for routing in R5 with modified OSM car speeds}
\usage{
build_custom_network(
  data_path,
  new_carspeeds = NULL,
  new_lts = NULL,
  output_path = tempdir_unique(),
  default_speed = NULL,
  default_lts = NULL,
  percentage_mode = TRUE,
  verbose = FALSE,
  elevation = "TOBLER"
)
}
\arguments{
\item{data_path}{Character. Path to the directory with the\code{.pbf} file of the
OSM network and optionally supporting data such as elevation and GTFS.}

\item{new_carspeeds}{A \code{data.frame} specifying the speed modifications. The
table must contain columns \code{osm_id} and \code{max_speed}. OR
A \verb{sf data.frame} specifying the speed modifications. The table must
contain columns \code{sf polygon}, \code{scale}, \code{priority}. See
\code{details}.}

\item{new_lts}{A \code{data.frame} specifying the LTS levels. The
table must contain columns \code{osm_id} and \code{lts}.}

\item{output_path}{Character. A string pointing to the directory where the
modified \code{network.dat} will be saved. Must be different from
\code{data_path}. Defaults to a temporary directory.}

\item{default_speed}{Numeric. Default speed to use for road segments not
specified in \code{new_carspeeds}. Must be \verb{>= }0. Defaults to \code{NULL} so that
roads not listed have their speeds unchanged. When set to \code{0}, the road
segment is assumed to be closed.}

\item{default_lts}{Numeric. Default LTS to use for road segments not
specified in \code{new_lts}. Must be 1-4. Defaults to \code{NULL} so that
roads not listed have their LTS unchanged.}

\item{percentage_mode}{Logical. Only OSM mode. If \code{TRUE}, values in \code{max_speed} are
interpreted as percentages of original speeds; if \code{FALSE}, as
absolute speeds (km/h). Defaults to \code{TRUE} - percentages.}

\item{verbose}{A logical. Whether to show \code{R5} informative messages when
running the function. Defaults to \code{FALSE} (please note that in such case
\code{R5} error messages are still shown). Setting \code{verbose} to \code{TRUE} shows
detailed output, which can be useful for debugging issues not caught by
\code{r5r}.}

\item{elevation}{A string. The name of the impedance function to be used to
calculate impedance for walking and cycling based on street slopes.
Available options include \code{TOBLER} (Default) and \code{MINETTI}, or \code{NONE}
to ignore elevation. R5 loads elevation data from \code{.tif} files saved
inside the \code{data_path} directory. See more info in the Details section
below.}
}
\value{
A \code{r5r_network} object representing the built network to connect with
\code{R5} routing engine, and a \code{network.dat} file saved in the \code{output_path}.
}
\description{
The function builds a transport network with modified OSM car speeds. The
function has two modes, hereby refereed to as "edge mode" and "polygon mode".
See the Details section below.
}
\details{
\itemize{
\item \strong{Edge mode:} The new speed factors must be passed as a \code{data.frame}
indicating the new max speed of each OSM edge id. The table must contain
columns \code{osm_id} and \code{max_speed}. Values in \code{max_speed} can be
interpreted as percentages of original speeds or as absolute speeds (km/h) by
using \code{percentage_mode} parameter.
\item \strong{Polygon mode:} The new speed factors must be passed through "congestion
region(s)" specified as an \verb{sf data.frame} containing  in each row an
\verb{sf polygon} outlining the "congestion region", \code{scale} and \code{priority}.
Values in \code{scale} can only be interpreted as percentages of original
speeds as \code{percentage_mode} must be \code{TRUE}. \code{Priority} is used to apply
a hierarchy in case of overlapping polygons.
}
}
\section{Elevation}{


More information about the \code{TOBLER} and \code{MINETTI} options to calculate the
effects of elevation on travel times can be found in the references below:
\itemize{
\item Campbell, M. J., et al (2019). Using crowdsourced fitness tracker data to
model the relationship between slope and travel rates. Applied geography, 106,
93-107. \doi{10.1016/j.apgeog.2019.03.008}.
\item Minetti, A. E., et al (2002). Energy cost of walking and running at extreme
uphill and downhill slopes. Journal of applied physiology. \doi{10.1152/japplphysiol.01177.2001}.
\item Tobler, W. (1993). Three presentations on geographical analysis and modeling:
Non-isotropic geographic modeling speculations on the geometry of geography
global spatial analysis. Technical Report. National center for geographic
information and analysis. 93 (1). \url{https://escholarship.org/uc/item/05r820mz}.
}
}

\examples{
\dontshow{if (identical(tolower(Sys.getenv("NOT_CRAN")), "true")) (if (getRversion() >= "3.4") withAutoprint else force)(\{ # examplesIf}
library(r5r)

# path to OSM .pbf file
data_path <- system.file("extdata/poa", package = "r5r")

# data.frame with new speed info
edge_speeds <- read.csv(file.path(data_path, "poa_osm_congestion.csv"))

r5r_network_new_speeds <- r5r::build_custom_network(
  data_path = data_path,
  new_carspeeds = edge_speeds,
  output_path = tempdir(),
  percentage_mode = TRUE
)

# sf with congestion polygons
congestion_poly <- readRDS(file.path(data_path, "poa_poly_congestion.rds"))

r5r_network_congestion <- r5r::build_custom_network(
  data_path = data_path,
  new_carspeeds = congestion_poly,
  output_path = tempdir(),
  percentage_mode = TRUE
)

\dontshow{\}) # examplesIf}
}
\seealso{
Other Build network: 
\code{\link{build_network}()},
\code{\link{download_r5}()},
\code{\link{setup_r5}()}
}
\concept{Build network}
