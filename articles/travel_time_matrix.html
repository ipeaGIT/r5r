<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Calculating travel time matrices • r5r</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Calculating travel time matrices">
<meta property="og:description" content="r5r">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">r5r</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.7.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/r5r.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/calculating_accessibility.html">Calculating and visualizing Accessibility</a>
    </li>
    <li>
      <a href="../articles/calculating_isochrones.html">Calculating and visualizing Isochrones</a>
    </li>
    <li>
      <a href="../articles/detailed_itineraries.html">Planning routes with detailed_itineraries()</a>
    </li>
    <li>
      <a href="../articles/fare_structure.html">Accounting for monetary costs</a>
    </li>
    <li>
      <a href="../articles/pareto_frontier.html">Analyzing the trade-offs between travel time and monetary cost</a>
    </li>
    <li>
      <a href="../articles/time_window.html">Using the time_window parameter</a>
    </li>
    <li>
      <a href="../articles/travel_time_matrix.html">Calculating travel time matrices</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ipeaGIT/r5r/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="travel_time_matrix_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Calculating travel time matrices</h1>
            
            <h4 data-toc-skip class="date">2022-05-19</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ipeaGIT/r5r/tree/master/r-package/../vignettes/travel_time_matrix.Rmd" class="external-link"><code>../vignettes/travel_time_matrix.Rmd</code></a></small>
      <div class="hidden name"><code>travel_time_matrix.Rmd</code></div>

    </div>

    
        <div class="abstract">
      <p class="abstract">Abstract</p>
      This vignette shows how to use the travel_time_matrix() and expanded_travel_time_matrix() functions in r5r.
    </div>
    
<div class="section level2">
<h2 id="introduction">1. Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Some of the most common tasks in transport planning and modeling involve require having good quality data with travel time estimates between origins and destinations. <code>R5</code> is incredibly fast in generating realistic door-to-door travel time estimates in multimodal transport systems.</p>
<p>The <code>r5r</code> packages has two functions that allow users to leverage the computing power of <code>R5</code>: - <code><a href="../reference/travel_time_matrix.html">travel_time_matrix()</a></code> - <code><a href="../reference/expanded_travel_time_matrix.html">expanded_travel_time_matrix()</a></code></p>
<p>This vignette shows a reproducible example to explain how these two functions work and the differences between them.</p>
</div>
<div class="section level2">
<h2 id="build-routable-transport-network-with-setup_r5">2. Build routable transport network with <code>setup_r5()</code><a class="anchor" aria-label="anchor" href="#build-routable-transport-network-with-setup_r5"></a>
</h2>
<p>First, let’s build the multimodal transport network we’ll be using in this vignette. In this example we’ll be using the a sample data set for the city of Porto Alegre (Brazil) included in <code>r5r</code>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># increase Java memory</span>
<span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>java.parameters <span class="op">=</span> <span class="st">"-Xmx2G"</span><span class="op">)</span>

<span class="co"># load libraries</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ipeaGIT/r5r" class="external-link">r5r</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span>

<span class="co"># build a routable transport network with r5r</span>
<span class="va">data_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/poa"</span>, package <span class="op">=</span> <span class="st">"r5r"</span><span class="op">)</span>
<span class="va">r5r_core</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/setup_r5.html">setup_r5</a></span><span class="op">(</span><span class="va">data_path</span><span class="op">)</span>

<span class="co"># routing inputs</span>
<span class="va">mode</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'walk'</span>, <span class="st">'transit'</span><span class="op">)</span>
<span class="va">max_trip_duration</span> <span class="op">&lt;-</span> <span class="fl">60</span> <span class="co"># minutes</span>

<span class="co"># departure time</span>
<span class="va">departure_datetime</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html" class="external-link">as.POSIXct</a></span><span class="op">(</span><span class="st">"13-05-2019 14:00:00"</span>, 
                                 format <span class="op">=</span> <span class="st">"%d-%m-%Y %H:%M:%S"</span><span class="op">)</span>

<span class="co"># load origin/destination points</span>
<span class="va">points</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/fread.html" class="external-link">fread</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">data_path</span>, <span class="st">"poa_points_of_interest.csv"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="the-travel_time_matrix-function">3. The <code>travel_time_matrix()</code> function<a class="anchor" aria-label="anchor" href="#the-travel_time_matrix-function"></a>
</h2>
<p>The <code><a href="../reference/travel_time_matrix.html">travel_time_matrix()</a></code> function provides a simple and really fast way to calculate the travel time between all possible origin destination pairs at a given departure time using a given transport mode.</p>
<p>The user can also customize many parameters such as: - <code>max_trip_duration</code>: maximum trip duration - <code>max_rides</code>: maximum number of transfer in the public transport system - <code>max_walk_dist</code> and <code>max_bike_dist</code>: maximum walking or cycling distance to and from public transport - <code>walk_speed</code> and <code>bike_speed</code>: maximum walking or cycling speed - <code>max_fare</code>: maximum monetary cost in public transport. <a href="https://ipeagit.github.io/r5r/articles/fare_calculator.html" class="external-link">See this vignette</a>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># estimate travel time matrix</span>
<span class="va">ttm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/travel_time_matrix.html">travel_time_matrix</a></span><span class="op">(</span><span class="va">r5r_core</span>,   
                          origins <span class="op">=</span> <span class="va">points</span>,
                          destinations <span class="op">=</span> <span class="va">points</span>,    
                          mode <span class="op">=</span> <span class="va">mode</span>,
                          max_trip_duration <span class="op">=</span> <span class="va">max_trip_duration</span>,
                          departure_datetime <span class="op">=</span> <span class="va">departure_datetime</span> <span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">ttm</span>, n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></code></pre></div>
<p>Now remember that travel time estimates can vary significantly across the day because of variations in public transport service levels. In order to account for this, you might want to calculate multiple travel time matrices departing at different times.</p>
<p>This can be done very efficiently by using the <code>time_window</code> and <code>percentile</code> parameters in the <code><a href="../reference/travel_time_matrix.html">travel_time_matrix()</a></code> function. When these parameters are set, R<sup>5</sup> will automatically compute multiple travel times estimates considering multiple departures per minute within the <code>time_window</code> selected by the user. <a href="https://ipeagit.github.io/r5r/articles/time_window.html" class="external-link">More information about this functionality can found in this vignette</a>.</p>
</div>
<div class="section level2">
<h2 id="the-expaded_travel_time_matrix-function">4. The <code>expaded_travel_time_matrix()</code> function<a class="anchor" aria-label="anchor" href="#the-expaded_travel_time_matrix-function"></a>
</h2>
<p>Sometimes, we want to know more than simply the total travel time from A to B. This is when the <code>expaded_travel_time_matrix()</code> function comes in. By default, the output of this function will also tell which public transport routes were taken between each origin destination pair.</p>
<p>Nonetheless, you may set the parameter <code>breakdown = TRUE</code> to gather much more info for each trip. In this case, <code>expaded_travel_time_matrix()</code> will tell the number of transfers used to complete each trip and their total access, waiting, in-vehicle and transfer times. Please note that setting <code>breakdown = TRUE</code> can make the function slower for large data sets.</p>
<p><em>A general call to expanded_travel_time_matrix()</em></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ettm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/expanded_travel_time_matrix.html">expanded_travel_time_matrix</a></span><span class="op">(</span><span class="va">r5r_core</span>,   
                                    origins <span class="op">=</span> <span class="va">points</span>,
                                    destinations <span class="op">=</span> <span class="va">points</span>,    
                                    mode <span class="op">=</span> <span class="va">mode</span>,
                                    max_trip_duration <span class="op">=</span> <span class="va">max_trip_duration</span>,
                                    departure_datetime <span class="op">=</span> <span class="va">departure_datetime</span> <span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">ettm</span>, n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></code></pre></div>
<p><em>Calling expanded_travel_time_matrix() with <code>breakdown = TRUE</code></em></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ettm2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/expanded_travel_time_matrix.html">expanded_travel_time_matrix</a></span><span class="op">(</span><span class="va">r5r_core</span>,   
                                    origins <span class="op">=</span> <span class="va">points</span>,
                                    destinations <span class="op">=</span> <span class="va">points</span>,    
                                    mode <span class="op">=</span> <span class="va">mode</span>,
                                    max_trip_duration <span class="op">=</span> <span class="va">max_trip_duration</span>,
                                    departure_datetime <span class="op">=</span> <span class="va">departure_datetime</span>,
                                    breakdown <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">ettm2</span>, n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></code></pre></div>
<p>You will notice in the documentation that the <code><a href="../reference/expanded_travel_time_matrix.html">expanded_travel_time_matrix()</a></code> also has a <code>time_window</code> parameter. In this case, though, when the user sets a <code>time_window</code> value, the <code><a href="../reference/expanded_travel_time_matrix.html">expanded_travel_time_matrix()</a></code> will return the fastest route alternative departing each minute within the specified time window. Please note this function can be very memory intensive for large data sets and time windows.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ettm_window</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/expanded_travel_time_matrix.html">expanded_travel_time_matrix</a></span><span class="op">(</span><span class="va">r5r_core</span>,   
                                           origins <span class="op">=</span> <span class="va">points</span>,
                                           destinations <span class="op">=</span> <span class="va">points</span>,    
                                           mode <span class="op">=</span> <span class="va">mode</span>,
                                           max_trip_duration <span class="op">=</span> <span class="va">max_trip_duration</span>,
                                           departure_datetime <span class="op">=</span> <span class="va">departure_datetime</span>,
                                           breakdown <span class="op">=</span> <span class="cn">TRUE</span>,
                                           time_window <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>

<span class="va">ettm_window</span><span class="op">[</span><span class="fl">15</span><span class="op">:</span><span class="fl">25</span>,<span class="op">]</span></code></pre></div>
<p>If you have any suggestions or want to report an error, please visit <a href="https://github.com/ipeaGIT/r5r" class="external-link">the package GitHub page</a>.</p>
<div class="section level3">
<h3 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h3>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Marcus Saraiva, Rafael H. M. Pereira, Daniel Herszenhut, Carlos Kaue Vieira Braga, Matthew Wigginton Conway, Ipea - Institute for Applied Economic Research.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.3.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
