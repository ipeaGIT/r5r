<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Intro to r5r: Rapid Realistic Routing with R5 in R • r5r</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Intro to r5r: Rapid Realistic Routing with R5 in R">
<meta property="og:description" content="r5r">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">r5r</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/r5r.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/accessibility.html">Accessibility</a>
    </li>
    <li>
      <a href="../articles/detailed_itineraries.html">Trip planning with detailed_itineraries()</a>
    </li>
    <li>
      <a href="../articles/faq.html">FAQ - Frequently Asked Questions</a>
    </li>
    <li>
      <a href="../articles/fare_structure.html">Accounting for monetary costs</a>
    </li>
    <li>
      <a href="../articles/isochrones.html">Isochrones</a>
    </li>
    <li>
      <a href="../articles/pareto_frontier.html">Trade-offs between travel time and monetary cost</a>
    </li>
    <li>
      <a href="../articles/time_window.html">Using the time_window parameter</a>
    </li>
    <li>
      <a href="../articles/travel_time_matrix.html">Travel time matrices</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ipeaGIT/r5r/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Intro to r5r: Rapid Realistic Routing with R5 in
R</h1>
                        <h4 data-toc-skip class="author">Rafael H. M.
Pereira, Marcus Saraiva, Daniel Herszenhut, Carlos Kaue Braga</h4>
            
            <h4 data-toc-skip class="date">2023-11-20</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ipeaGIT/r5r/tree/master/r-package/../vignettes/r5r.Rmd" class="external-link"><code>../vignettes/r5r.Rmd</code></a></small>
      <div class="hidden name"><code>r5r.Rmd</code></div>

    </div>

    
        <div class="abstract">
      <p class="abstract">Abstract</p>
      <code>r5r</code> is an R package for rapid realistic routing on
      multimodal transport networks (walk, bike, public transport and
      car) using R<sup>5</sup>. The package allows users to generate
      detailed routing analysis or calculate travel time matrices using
      seamless parallel computing on top of the R<sup>5</sup> Java
      machine <a href="https://github.com/conveyal/r5" class="external-link uri">https://github.com/conveyal/r5</a>
    </div>
    
<div class="section level2">
<h2 id="introduction">1. Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p><strong>r5r</strong> is an <a href="https://github.com/ipeaGIT/r5r" class="external-link">R
package for rapid realistic routing on multimodal transport networks</a>
(walk, bike, public transport and car). It provides a simple and
friendly interface to R<sup>5</sup>, a really fast and open source
Java-based routing engine developed separately by <a href="https://www.conveyal.com/" class="external-link">Conveyal</a>. R<sup>5</sup> stands for
<a href="https://github.com/conveyal/r5" class="external-link">Rapid Realistic Routing on
Real-world and Reimagined networks</a>. More details about
<strong>r5r</strong> can be found on the <a href="https://ipeagit.github.io/r5r/index.html" class="external-link">package webpage</a> or
on this <a href="https://doi.org/10.32866/001c.21262" class="external-link">paper</a>.</p>
</div>
<div class="section level2">
<h2 id="installation">2. Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install <code>r5r</code> from CRAN, or the development
version from github.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># CRAN</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">'r5r'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># dev version on github</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"ipeaGIT/r5r"</span>, subdir <span class="op">=</span> <span class="st">"r-package"</span><span class="op">)</span></span></code></pre></div>
<p>Please bear in mind that you need to have <em>Java SE Development Kit
11</em> installed on your computer to use <code>r5r</code>. No worries,
you don’t have to pay for it. The jdk 11 is freely available from the
options below: - <a href="https://jdk.java.net/java-se-ri/11" class="external-link">OpenJDK</a> - <a href="https://www.oracle.com/java/technologies/javase-jdk11-downloads.html" class="external-link">Oracle</a></p>
<p>If you don’t know what version of Java you have installed on your
computer, you can check it by running this on R console.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="fu">rJava</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rJava/man/jinit.html" class="external-link">.jinit</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="fu">rJava</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rJava/man/jcall.html" class="external-link">.jcall</a></span><span class="op">(</span><span class="st">"java.lang.System"</span>, <span class="st">"S"</span>, <span class="st">"getProperty"</span>, <span class="st">"java.version"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="usage">3. Usage<a class="anchor" aria-label="anchor" href="#usage"></a>
</h2>
<p>Before we start, we need to increase the memory available to Java.
This is necessary because, by default, <code>R</code> allocates only
512MB of memory for Java processes, which is not enough for large
queries using <code>r5r</code>. To increase available memory to 2GB, for
example, we need to set the <code>java.parameters</code> option at the
beginning of the script, as follows:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>java.parameters <span class="op">=</span> <span class="st">"-Xmx2G"</span><span class="op">)</span></span></code></pre></div>
<p>Note: It’s very important to allocate enough memory before loading
<code>r5r</code> or any other Java-based package, since
<code>rJava</code> starts a Java Virtual Machine only once for each R
session. It might be useful to restart your R session and execute the
code above right after, if you notice that you haven’t succeeded in your
previous attempts.</p>
<p>Then we can load the packages used in this vignette:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ipeaGIT/r5r" class="external-link">r5r</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
<p>The <code>r5r</code> package has seven <strong>fundamental
functions</strong>:</p>
<ol style="list-style-type: decimal">
<li><p><code><a href="../reference/setup_r5.html">setup_r5()</a></code> to initialize an instance of
<code>r5r</code>, that also builds a routable transport
network;</p></li>
<li><p><code><a href="../reference/accessibility.html">accessibility()</a></code> for fast computation of access to
opportunities considering a selected decay function;</p></li>
<li><p><code><a href="../reference/travel_time_matrix.html">travel_time_matrix()</a></code> for fast computation of travel
time estimates between origin/destination pairs;</p></li>
<li><p><code><a href="../reference/expanded_travel_time_matrix.html">expanded_travel_time_matrix()</a></code> for calculating travel
matrices between origin destination pairs with additional information
such as routes used and total time disaggregated by access, waiting,
in-vehicle and transfer times.</p></li>
<li><p><code><a href="../reference/detailed_itineraries.html">detailed_itineraries()</a></code> to get detailed information
on one or multiple alternative routes between origin/destination
pairs.</p></li>
<li><p><code><a href="../reference/pareto_frontier.html">pareto_frontier()</a></code> for analyzing the trade-off
between the travel time and monetary costs of multiple route
alternatives between origin/destination pairs.</p></li>
<li><p><code><a href="../reference/isochrone.html">isochrone()</a></code> to estimate the polygons of the areas
that can be reached from an origin point at different travel time
limits.</p></li>
</ol>
<p>Most of these functions also allow users to account for monetary
travel costs when generating travel time matrices and accessibility
estimates. More info about how to consider monetary costs can be found
in <a href="https://ipeagit.github.io/r5r/articles/fare_structure.html" class="external-link">this
vignette</a>.</p>
<p>The package also includes a few <strong>support
functions</strong>.</p>
<ol style="list-style-type: decimal">
<li><p><code><a href="../reference/street_network_to_sf.html">street_network_to_sf()</a></code> to extract OpenStreetMap
network in sf format from a <code>network.dat</code> file.</p></li>
<li><p><code><a href="../reference/transit_network_to_sf.html">transit_network_to_sf()</a></code> to extract transit network
in sf format from a <code>network.dat</code> file.</p></li>
<li><p><code><a href="../reference/find_snap.html">find_snap()</a></code> to find snapped locations of input
points on street network.</p></li>
<li><p><code><a href="../reference/r5r_sitrep.html">r5r_sitrep()</a></code> to generate a situation report to help
debug eventual errors.</p></li>
</ol>
<div class="section level3">
<h3 id="data-requirements">3.1 Data requirements:<a class="anchor" aria-label="anchor" href="#data-requirements"></a>
</h3>
<p>To use <code>r5r</code>, you will need: - A road network data set
from OpenStreetMap in <code>.pbf</code> format (<em>mandatory</em>) - A
public transport feed in <code>GTFS.zip</code> format (optional) - A
raster file of Digital Elevation Model data in <code>.tif</code> format
(optional)</p>
<p>Here are a few places from where you can download these data
sets:</p>
<ul>
<li>OpenStreetMap
<ul>
<li>
<a href="https://docs.ropensci.org/osmextract/" class="external-link">osmextract</a> R
package</li>
<li>
<a href="https://download.geofabrik.de/" class="external-link">geofabrik</a> website</li>
<li>
<a href="https://export.hotosm.org/" class="external-link">hot export tool</a>
website</li>
<li>
<a href="https://extract.bbbike.org/" class="external-link">BBBike.org</a> website</li>
<li>
<a href="https://protomaps.com/downloads/osm" class="external-link">Protomaps</a>
website</li>
</ul>
</li>
<li>GTFS
<ul>
<li>
<a href="https://r-transit.github.io/tidytransit/" class="external-link">tidytransit</a> R
package</li>
<li>
<a href="https://www.transit.land/" class="external-link">transitland</a> website</li>
<li>
<a href="https://database.mobilitydata.org/" class="external-link">Mobility Database</a>
website</li>
</ul>
</li>
<li>Elevation
<ul>
<li>
<a href="https://github.com/jhollist/elevatr" class="external-link">elevatr</a> R
package</li>
<li>Nasa’s SRTMGL1 website</li>
</ul>
</li>
</ul>
<p>Let’s have a quick look at how <code>r5r</code> works using a sample
data set.</p>
</div>
</div>
<div class="section level2">
<h2 id="demonstration-on-sample-data">4. Demonstration on sample data<a class="anchor" aria-label="anchor" href="#demonstration-on-sample-data"></a>
</h2>
<div class="section level3">
<h3 id="data">Data<a class="anchor" aria-label="anchor" href="#data"></a>
</h3>
<p>To illustrate the functionalities of <code>r5r</code>, the package
includes a small sample data for the city of Porto Alegre (Brazil). It
includes seven files:</p>
<ul>
<li>An OpenStreetMap network: <code>poa_osm.pbf</code>
</li>
<li>Two public transport feeds: <code>poa_eptc.zip</code> and
<code>poa_trensurb.zip</code>
</li>
<li>A raster elevation data: <code>poa_elevation.tif</code>
</li>
<li>A <code>poa_hexgrid.csv</code> file with spatial coordinates of a
regular hexagonal grid covering the sample area, which can be used as
origin/destination pairs in a travel time matrix calculation.</li>
<li>A <code>poa_points_of_interest.csv</code> file containing the names
and spatial coordinates of 15 places within Porto Alegre</li>
<li>A <code>fares_poa.zip</code> file with the fare rules of the city’s
public transport system.</li>
</ul>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/poa"</span>, package <span class="op">=</span> <span class="st">"r5r"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">data_path</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "fares"                      "network_settings.json"     </span></span>
<span><span class="co">#&gt;  [3] "network.dat"                "poa_elevation.tif"         </span></span>
<span><span class="co">#&gt;  [5] "poa_eptc.zip"               "poa_hexgrid.csv"           </span></span>
<span><span class="co">#&gt;  [7] "poa_osm.pbf"                "poa_osm.pbf.mapdb"         </span></span>
<span><span class="co">#&gt;  [9] "poa_osm.pbf.mapdb.p"        "poa_points_of_interest.csv"</span></span>
<span><span class="co">#&gt; [11] "poa_trensurb.zip"</span></span></code></pre></div>
<p>The points of interest data can be seen below. In this example, we
will be looking at transport alternatives between some of those
places.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">poi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/fread.html" class="external-link">fread</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">data_path</span>, <span class="st">"poa_points_of_interest.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">poi</span><span class="op">)</span></span>
<span><span class="co">#&gt;                     id       lat       lon</span></span>
<span><span class="co">#&gt; 1:       public_market -30.02756 -51.22781</span></span>
<span><span class="co">#&gt; 2: bus_central_station -30.02329 -51.21886</span></span>
<span><span class="co">#&gt; 3:    gasometer_museum -30.03404 -51.24095</span></span>
<span><span class="co">#&gt; 4: santa_casa_hospital -30.03043 -51.22240</span></span>
<span><span class="co">#&gt; 5:            townhall -30.02800 -51.22865</span></span>
<span><span class="co">#&gt; 6:     piratini_palace -30.03363 -51.23068</span></span></code></pre></div>
<p>The data with origin destination pairs is shown below. In this
example, we will be using 200 points randomly selected from this data
set.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">points</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/fread.html" class="external-link">fread</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">data_path</span>, <span class="st">"poa_hexgrid.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># sample points</span></span>
<span><span class="va">sampled_rows</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">points</span><span class="op">)</span>, <span class="fl">200</span>, replace<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">points</span> <span class="op">&lt;-</span> <span class="va">points</span><span class="op">[</span> <span class="va">sampled_rows</span>, <span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">points</span><span class="op">)</span></span>
<span><span class="co">#&gt;                 id       lon       lat population schools jobs healthcare</span></span>
<span><span class="co">#&gt; 1: 89a90129a53ffff -51.14157 -30.01779        433       0   23          0</span></span>
<span><span class="co">#&gt; 2: 89a9012802fffff -51.20115 -30.06129        602       1  105          0</span></span>
<span><span class="co">#&gt; 3: 89a9012848fffff -51.19940 -30.09333         31       0    0          0</span></span>
<span><span class="co">#&gt; 4: 89a901286c3ffff -51.16874 -30.08762        160       0    0          0</span></span>
<span><span class="co">#&gt; 5: 89a90128eabffff -51.22153 -30.03874       1443       0  646          0</span></span>
<span><span class="co">#&gt; 6: 89a9012ae1bffff -51.23567 -30.08745        594       0   39          0</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="building-routable-transport-network-with-setup_r5">4.1 Building routable transport network with
<code>setup_r5()</code><a class="anchor" aria-label="anchor" href="#building-routable-transport-network-with-setup_r5"></a>
</h3>
<p>The first step is to build the multimodal transport network used for
routing in R<sup>5</sup>. This is done with the <code>setup_r5</code>
function. This function does two things: (1) downloads/updates a
compiled JAR file of R<sup>5</sup> and stores it locally in the
<code>r5r</code> package directory for future use; and (2) combines the
osm.pbf and gtfs.zip data sets to build a routable network object.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Indicate the path where OSM and GTFS data are stored</span></span>
<span><span class="va">r5r_core</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/setup_r5.html">setup_r5</a></span><span class="op">(</span>data_path <span class="op">=</span> <span class="va">data_path</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="accessibility-analysis">4.2 Accessibility analysis<a class="anchor" aria-label="anchor" href="#accessibility-analysis"></a>
</h3>
<p>The fastest way to calculate accessibility estimates is using the
<code><a href="../reference/accessibility.html">accessibility()</a></code> function. In this example, we calculate the
number of schools and health care facilities accessible in less than 60
minutes by public transport and walking. More details in this vignette
on <a href="https://ipeagit.github.io/r5r/articles/accessibility.html" class="external-link">Calculating
and visualizing Accessibility</a>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set departure datetime input</span></span>
<span><span class="va">departure_datetime</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html" class="external-link">as.POSIXct</a></span><span class="op">(</span><span class="st">"13-05-2019 14:00:00"</span>,</span>
<span>                                 format <span class="op">=</span> <span class="st">"%d-%m-%Y %H:%M:%S"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># calculate accessibility</span></span>
<span><span class="va">access</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/accessibility.html">accessibility</a></span><span class="op">(</span>r5r_core <span class="op">=</span> <span class="va">r5r_core</span>,</span>
<span>                        origins <span class="op">=</span> <span class="va">points</span>,</span>
<span>                        destinations <span class="op">=</span> <span class="va">points</span>,</span>
<span>                        opportunities_colnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"schools"</span>, <span class="st">"healthcare"</span><span class="op">)</span>,</span>
<span>                        mode <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"WALK"</span>, <span class="st">"TRANSIT"</span><span class="op">)</span>,</span>
<span>                        departure_datetime <span class="op">=</span> <span class="va">departure_datetime</span>,</span>
<span>                        decay_function <span class="op">=</span> <span class="st">"step"</span>,</span>
<span>                        cutoffs <span class="op">=</span> <span class="fl">60</span></span>
<span>                        <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">access</span><span class="op">)</span></span>
<span><span class="co">#&gt;                 id opportunity percentile cutoff accessibility</span></span>
<span><span class="co">#&gt; 1: 89a90129a53ffff     schools         50     60            19</span></span>
<span><span class="co">#&gt; 2: 89a90129a53ffff  healthcare         50     60             9</span></span>
<span><span class="co">#&gt; 3: 89a9012802fffff     schools         50     60            31</span></span>
<span><span class="co">#&gt; 4: 89a9012802fffff  healthcare         50     60            13</span></span>
<span><span class="co">#&gt; 5: 89a9012848fffff     schools         50     60             3</span></span>
<span><span class="co">#&gt; 6: 89a9012848fffff  healthcare         50     60             0</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="routing-analysis">4.3 Routing analysis<a class="anchor" aria-label="anchor" href="#routing-analysis"></a>
</h3>
<p>For fast routing analysis, <strong>r5r</strong> currently has three
core functions: <code><a href="../reference/travel_time_matrix.html">travel_time_matrix()</a></code>,
<code><a href="../reference/expanded_travel_time_matrix.html">expanded_travel_time_matrix()</a></code> and
<code><a href="../reference/detailed_itineraries.html">detailed_itineraries()</a></code>.</p>
<div class="section level4">
<h4 id="fast-many-to-many-travel-time-matrix">Fast many to many travel time matrix<a class="anchor" aria-label="anchor" href="#fast-many-to-many-travel-time-matrix"></a>
</h4>
<p>The <code><a href="../reference/travel_time_matrix.html">travel_time_matrix()</a></code> function is a really simple and
fast function to compute travel time estimates between one or multiple
origin/destination pairs. The origin/destination input can be either a
spatial <code>sf POINT</code> object, or a <code>data.frame</code>
containing the columns <code>id, lon, lat</code>. The function also
receives as inputs the <em>max walking distance</em>, in meters, and the
<em>max trip duration</em>, in minutes. Resulting travel times are also
output in minutes.</p>
<p>This function also allows users to very efficiently capture the
travel time uncertainties inside a given time window considering
multiple departure times. <a href="https://ipeagit.github.io/r5r/articles/time_window.html" class="external-link">More info
on this vignette</a>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set inputs</span></span>
<span><span class="va">mode</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"WALK"</span>, <span class="st">"TRANSIT"</span><span class="op">)</span></span>
<span><span class="va">max_walk_time</span> <span class="op">&lt;-</span> <span class="fl">30</span> <span class="co"># minutes</span></span>
<span><span class="va">max_trip_duration</span> <span class="op">&lt;-</span> <span class="fl">120</span> <span class="co"># minutes</span></span>
<span><span class="va">departure_datetime</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html" class="external-link">as.POSIXct</a></span><span class="op">(</span><span class="st">"13-05-2019 14:00:00"</span>,</span>
<span>                                 format <span class="op">=</span> <span class="st">"%d-%m-%Y %H:%M:%S"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># calculate a travel time matrix</span></span>
<span><span class="va">ttm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/travel_time_matrix.html">travel_time_matrix</a></span><span class="op">(</span>r5r_core <span class="op">=</span> <span class="va">r5r_core</span>,</span>
<span>                          origins <span class="op">=</span> <span class="va">poi</span>,</span>
<span>                          destinations <span class="op">=</span> <span class="va">poi</span>,</span>
<span>                          mode <span class="op">=</span> <span class="va">mode</span>,</span>
<span>                          departure_datetime <span class="op">=</span> <span class="va">departure_datetime</span>,</span>
<span>                          max_walk_time <span class="op">=</span> <span class="va">max_walk_time</span>,</span>
<span>                          max_trip_duration <span class="op">=</span> <span class="va">max_trip_duration</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">ttm</span><span class="op">)</span></span>
<span><span class="co">#&gt;          from_id               to_id travel_time_p50</span></span>
<span><span class="co">#&gt; 1: public_market       public_market               0</span></span>
<span><span class="co">#&gt; 2: public_market bus_central_station              14</span></span>
<span><span class="co">#&gt; 3: public_market    gasometer_museum              12</span></span>
<span><span class="co">#&gt; 4: public_market santa_casa_hospital              15</span></span>
<span><span class="co">#&gt; 5: public_market            townhall               3</span></span>
<span><span class="co">#&gt; 6: public_market     piratini_palace              17</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="expanded-travel-time-matrix-with-minute-by-minute-estimates">Expanded travel time matrix with minute-by-minute estimates<a class="anchor" aria-label="anchor" href="#expanded-travel-time-matrix-with-minute-by-minute-estimates"></a>
</h4>
<p>For those interested in more detailed outputs, the
<code><a href="../reference/expanded_travel_time_matrix.html">expanded_travel_time_matrix()</a></code> works very similarly with
<code><a href="../reference/travel_time_matrix.html">travel_time_matrix()</a></code> but it brings much more information.
It estimates for each origin destination pair the routes used and total
time disaggregated by access, waiting, in-vehicle and transfer times.
Please note this function can be very memory intensive for large data
sets.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># calculate a travel time matrix</span></span>
<span><span class="va">ettm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/expanded_travel_time_matrix.html">expanded_travel_time_matrix</a></span><span class="op">(</span>r5r_core <span class="op">=</span> <span class="va">r5r_core</span>,</span>
<span>                          origins <span class="op">=</span> <span class="va">poi</span>,</span>
<span>                          destinations <span class="op">=</span> <span class="va">poi</span>,</span>
<span>                          mode <span class="op">=</span> <span class="va">mode</span>,</span>
<span>                          departure_datetime <span class="op">=</span> <span class="va">departure_datetime</span>,</span>
<span>                          breakdown <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                          max_walk_time <span class="op">=</span> <span class="va">max_walk_time</span>,</span>
<span>                          max_trip_duration <span class="op">=</span> <span class="va">max_trip_duration</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">ettm</span><span class="op">)</span></span>
<span><span class="co">#&gt;          from_id         to_id departure_time draw_number access_time wait_time</span></span>
<span><span class="co">#&gt; 1: public_market public_market       14:00:00           1           0         0</span></span>
<span><span class="co">#&gt; 2: public_market public_market       14:01:00           1           0         0</span></span>
<span><span class="co">#&gt; 3: public_market public_market       14:02:00           1           0         0</span></span>
<span><span class="co">#&gt; 4: public_market public_market       14:03:00           1           0         0</span></span>
<span><span class="co">#&gt; 5: public_market public_market       14:04:00           1           0         0</span></span>
<span><span class="co">#&gt; 6: public_market public_market       14:05:00           1           0         0</span></span>
<span><span class="co">#&gt;    ride_time transfer_time egress_time routes n_rides total_time</span></span>
<span><span class="co">#&gt; 1:         0             0           0 [WALK]       0          0</span></span>
<span><span class="co">#&gt; 2:         0             0           0 [WALK]       0          0</span></span>
<span><span class="co">#&gt; 3:         0             0           0 [WALK]       0          0</span></span>
<span><span class="co">#&gt; 4:         0             0           0 [WALK]       0          0</span></span>
<span><span class="co">#&gt; 5:         0             0           0 [WALK]       0          0</span></span>
<span><span class="co">#&gt; 6:         0             0           0 [WALK]       0          0</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="detailed-itineraries">Detailed itineraries<a class="anchor" aria-label="anchor" href="#detailed-itineraries"></a>
</h4>
<p>Most routing packages only return the fastest route. A key advantage
of the <code><a href="../reference/detailed_itineraries.html">detailed_itineraries()</a></code> function is that is allows
for fast routing analysis while providing multiple alternative routes
between origin destination pairs. The output also brings detailed
information for each route alternative at the trip segment level,
including the transport mode, waiting times, travel time and distance of
each trip segment.</p>
<p>In this example below, we want to know some alternative routes
between one origin/destination pair only.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set inputs</span></span>
<span><span class="va">origins</span> <span class="op">&lt;-</span> <span class="va">poi</span><span class="op">[</span><span class="fl">10</span>,<span class="op">]</span></span>
<span><span class="va">destinations</span> <span class="op">&lt;-</span> <span class="va">poi</span><span class="op">[</span><span class="fl">12</span>,<span class="op">]</span></span>
<span><span class="va">mode</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"WALK"</span>, <span class="st">"TRANSIT"</span><span class="op">)</span></span>
<span><span class="va">max_walk_time</span> <span class="op">&lt;-</span> <span class="fl">60</span> <span class="co"># minutes</span></span>
<span><span class="va">departure_datetime</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html" class="external-link">as.POSIXct</a></span><span class="op">(</span><span class="st">"13-05-2019 14:00:00"</span>,</span>
<span>                                 format <span class="op">=</span> <span class="st">"%d-%m-%Y %H:%M:%S"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># calculate detailed itineraries</span></span>
<span><span class="va">det</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/detailed_itineraries.html">detailed_itineraries</a></span><span class="op">(</span>r5r_core <span class="op">=</span> <span class="va">r5r_core</span>,</span>
<span>                            origins <span class="op">=</span> <span class="va">origins</span>,</span>
<span>                            destinations <span class="op">=</span> <span class="va">destinations</span>,</span>
<span>                            mode <span class="op">=</span> <span class="va">mode</span>,</span>
<span>                            departure_datetime <span class="op">=</span> <span class="va">departure_datetime</span>,</span>
<span>                            max_walk_time <span class="op">=</span> <span class="va">max_walk_time</span>,</span>
<span>                            shortest_path <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">det</span><span class="op">)</span></span>
<span><span class="co">#&gt; Simple feature collection with 6 features and 16 fields</span></span>
<span><span class="co">#&gt; Geometry type: LINESTRING</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: -51.24094 ymin: -30.05 xmax: -51.19762 ymax: -29.99729</span></span>
<span><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span><span class="co">#&gt;            from_id  from_lat  from_lon                          to_id    to_lat</span></span>
<span><span class="co">#&gt; 1 farrapos_station -29.99772 -51.19762 praia_de_belas_shopping_center -30.04995</span></span>
<span><span class="co">#&gt; 2 farrapos_station -29.99772 -51.19762 praia_de_belas_shopping_center -30.04995</span></span>
<span><span class="co">#&gt; 3 farrapos_station -29.99772 -51.19762 praia_de_belas_shopping_center -30.04995</span></span>
<span><span class="co">#&gt; 4 farrapos_station -29.99772 -51.19762 praia_de_belas_shopping_center -30.04995</span></span>
<span><span class="co">#&gt; 5 farrapos_station -29.99772 -51.19762 praia_de_belas_shopping_center -30.04995</span></span>
<span><span class="co">#&gt; 6 farrapos_station -29.99772 -51.19762 praia_de_belas_shopping_center -30.04995</span></span>
<span><span class="co">#&gt;      to_lon option departure_time total_duration total_distance segment mode</span></span>
<span><span class="co">#&gt; 1 -51.22875      1       14:09:10           36.2           9460       1 WALK</span></span>
<span><span class="co">#&gt; 2 -51.22875      1       14:09:10           36.2           9460       2 RAIL</span></span>
<span><span class="co">#&gt; 3 -51.22875      1       14:09:10           36.2           9460       3 WALK</span></span>
<span><span class="co">#&gt; 4 -51.22875      1       14:09:10           36.2           9460       4  BUS</span></span>
<span><span class="co">#&gt; 5 -51.22875      1       14:09:10           36.2           9460       5 WALK</span></span>
<span><span class="co">#&gt; 6 -51.22875      2       14:09:43           48.7           8779       1 WALK</span></span>
<span><span class="co">#&gt;   segment_duration wait distance  route                       geometry</span></span>
<span><span class="co">#&gt; 1              4.6  0.0      174        LINESTRING (-51.1981 -29.99...</span></span>
<span><span class="co">#&gt; 2              6.6  1.3     4796 LINHA1 LINESTRING (-51.19763 -29.9...</span></span>
<span><span class="co">#&gt; 3              5.7  0.0      256        LINESTRING (-51.22827 -30.0...</span></span>
<span><span class="co">#&gt; 4             10.4  4.4     4083    188 LINESTRING (-51.22926 -30.0...</span></span>
<span><span class="co">#&gt; 5              3.2  0.0      151        LINESTRING (-51.22949 -30.0...</span></span>
<span><span class="co">#&gt; 6              4.6  0.0      174        LINESTRING (-51.1981 -29.99...</span></span></code></pre></div>
<p>The output is a <code>data.frame sf</code> object, so we can easily
visualize the results.</p>
<div class="section level5">
<h5 id="visualize-results">Visualize results<a class="anchor" aria-label="anchor" href="#visualize-results"></a>
</h5>
<p><strong>Static visualization</strong> with <code>ggplot2</code>
package: To provide a geographic context for the visualization of the
results in <code>ggplot2</code>, you can also use the
<code><a href="../reference/street_network_to_sf.html">street_network_to_sf()</a></code> function to extract the OSM street
network used in the routing.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># extract OSM network</span></span>
<span><span class="va">street_net</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/street_network_to_sf.html">street_network_to_sf</a></span><span class="op">(</span><span class="va">r5r_core</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># extract public transport network</span></span>
<span><span class="va">transit_net</span> <span class="op">&lt;-</span> <span class="fu">r5r</span><span class="fu">::</span><span class="fu"><a href="../reference/transit_network_to_sf.html">transit_network_to_sf</a></span><span class="op">(</span><span class="va">r5r_core</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">street_net</span><span class="op">$</span><span class="va">edges</span>, color<span class="op">=</span><span class="st">'gray85'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">det</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color<span class="op">=</span><span class="va">mode</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="va">.</span><span class="op">~</span><span class="va">option</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="r5r_files/figure-html/unnamed-chunk-14-1.png" width="100%"></p>
</div>
</div>
<div class="section level4">
<h4 id="cleaning-up-after-usage">Cleaning up after usage<a class="anchor" aria-label="anchor" href="#cleaning-up-after-usage"></a>
</h4>
<p><code>r5r</code> objects are still allocated to any amount of memory
previously set after they are done with their calculations. In order to
remove an existing <code>r5r</code> object and reallocate the memory it
had been using, we use the <code>stop_r5</code> function followed by a
call to Java’s garbage collector, as follows:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">r5r</span><span class="fu">::</span><span class="fu"><a href="../reference/stop_r5.html">stop_r5</a></span><span class="op">(</span><span class="va">r5r_core</span><span class="op">)</span></span>
<span><span class="fu">rJava</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rJava/man/jgc.html" class="external-link">.jgc</a></span><span class="op">(</span>R.gc <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>If you have any suggestions or want to report an error, please visit
<a href="https://github.com/ipeaGIT/r5r" class="external-link">the package GitHub
page</a>.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Marcus Saraiva, Rafael H. M. Pereira, Daniel Herszenhut, Carlos Kaue Vieira Braga, Matthew Wigginton Bhagat-Conway, Ipea - Institute for Applied Economic Research.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
