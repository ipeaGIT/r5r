<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Analyzing the trade-offs between travel time and monetary cost • r5r</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Analyzing the trade-offs between travel time and monetary cost">
<meta property="og:description" content="r5r">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">r5r</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.7.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/r5r.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/calculating_accessibility.html">Calculating and visualizing Accessibility</a>
    </li>
    <li>
      <a href="../articles/calculating_isochrones.html">Calculating and visualizing Isochrones</a>
    </li>
    <li>
      <a href="../articles/detailed_itineraries.html">Planning routes with detailed_itineraries()</a>
    </li>
    <li>
      <a href="../articles/fare_structure.html">Accounting for monetary costs</a>
    </li>
    <li>
      <a href="../articles/pareto_frontier.html">Analyzing the trade-offs between travel time and monetary cost</a>
    </li>
    <li>
      <a href="../articles/time_window.html">Using the time_window parameter</a>
    </li>
    <li>
      <a href="../articles/travel_time_matrix.html">Calculating travel time matrices</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ipeaGIT/r5r/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="pareto_frontier_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Analyzing the trade-offs between travel time and monetary cost</h1>
            
            <h4 data-toc-skip class="date">2022-06-02</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ipeaGIT/r5r/tree/master/r-package/../vignettes/pareto_frontier.Rmd" class="external-link"><code>../vignettes/pareto_frontier.Rmd</code></a></small>
      <div class="hidden name"><code>pareto_frontier.Rmd</code></div>

    </div>

    
        <div class="abstract">
      <p class="abstract">Abstract</p>
      This vignette shows how to use the <code><a href="../reference/pareto_frontier.html">pareto_frontier()</a></code> function to examine the trade-offs between travel time and monetary cost in travel time matrices in r5r.
    </div>
    
<div class="section level2">
<h2 id="introduction">1. Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>In most cases, transport routing models find either the fastest or the lowest-cost routes that connect places in a given transport network. Sometimes, though, we might want a more sophisticated analysis that considers both the time and monetary costs that public transport passengers have to face. The problem here is that simultaneously accounting for both time and monetary costs is a major challenge for routing models because of the trade-offs between the objectives of minimizing trip duration and cost <a href="https://www.tandfonline.com/doi/abs/10.1080/13658816.2019.1605075" class="external-link">(ref ‘Getting Charlie off the MTA’)</a>.</p>
<p>To address this problem, <code>r5r</code> has a function called <code><a href="../reference/pareto_frontier.html">pareto_frontier()</a></code>, which calculates the most efficient route possibilities between origin destination pairs considering multiple combinations of travel time and monetary costs. This vignette uses a reproducible example to demonstrate how to use <code><a href="../reference/pareto_frontier.html">pareto_frontier()</a></code> and interpret its results.</p>
<div class="section level3">
<h3 id="what-the-pareto_frontier-means-">2. What the <code>pareto_frontier</code> means.<a class="anchor" aria-label="anchor" href="#what-the-pareto_frontier-means-"></a>
</h3>
<p>Imagine a hypothetical journey from A to B. There are multiple route alternatives between this origin and destination with varying combinations of travel time and cost (figure below).</p>
<ul>
<li>Walking from A to B would be the <strong>cheapest</strong> option but it would take 50 minutes.</li>
<li>The <strong>fastest</strong> option would be to take a bus to a subway station and transfer to the subway. This option would only take 15 minutes, but it would cost $8.</li>
<li>There are some intermediary alternatives, such as taking:
<ul>
<li>a single bus, $3 for 35 min.</li>
<li>two buses with one transfer, $5 for 29 min.</li>
<li>taking the subway after walking to the station , $6 for 20 min.</li>
</ul>
</li>
</ul>
<p>This figure illustrates the Pareto frontier of alternative routes from A to B. In other words, it shows the most optimal set of route alternatives between A and B. There are certainly other route options, but there is no other option that is both faster and cheaper at the same time.</p>
<p><img src="pareto_frontier_files/figure-html/unnamed-chunk-2-1.png" width="672"></p>
<p><br></p>
<p>This kind of abstraction allows us to have a better grasp of the trade-offs between travel time and monetary cost passengers face when using public transport. It also allows us to calculate cumulative-opportunity accessibility metrics with cutoffs for both time and cost (e.g. the number of jobs reachable from a given origin with limits of 40 minutes and $5) (ref paper by Matt and Anson).</p>
<p>Let’s see a couple concrete examples showing how <code>r5r</code> can calculate the Pareto frontier for multiple origins.</p>
</div>
<div class="section level3">
<h3 id="demonstration-of-pareto_frontier-">3. Demonstration of <code>pareto_frontier()</code>.<a class="anchor" aria-label="anchor" href="#demonstration-of-pareto_frontier-"></a>
</h3>
<div class="section level4">
<h4 id="build-routable-transport-network-with-setup_r5">3.1 Build routable transport network with <code>setup_r5()</code><a class="anchor" aria-label="anchor" href="#build-routable-transport-network-with-setup_r5"></a>
</h4>
<p>First, let’s build the network and create the routing inputs. In this example we’ll be using the a sample data set for the city of Porto Alegre (Brazil) included in <code>r5r</code>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># increase Java memory</span>
<span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>java.parameters <span class="op">=</span> <span class="st">"-Xmx2G"</span><span class="op">)</span>

<span class="co"># load libraries</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ipeaGIT/r5r" class="external-link">r5r</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span>

<span class="co"># build a routable transport network with r5r</span>
<span class="va">data_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/poa"</span>, package <span class="op">=</span> <span class="st">"r5r"</span><span class="op">)</span>
<span class="va">r5r_core</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/setup_r5.html">setup_r5</a></span><span class="op">(</span><span class="va">data_path</span><span class="op">)</span>

<span class="co"># routing inputs</span>
<span class="va">mode</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'walk'</span>, <span class="st">'transit'</span><span class="op">)</span>
<span class="va">max_walk_dist</span> <span class="op">&lt;-</span> <span class="fl">1000</span> <span class="co"># meters</span>
<span class="va">max_trip_duration</span> <span class="op">&lt;-</span> <span class="fl">90</span> <span class="co"># minutes</span>

<span class="co"># load origin/destination points of interest</span>
<span class="va">points</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/fread.html" class="external-link">fread</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">data_path</span>, <span class="st">"poa_points_of_interest.csv"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="set-up-the-fare-structure">3.2 Set up the fare structure<a class="anchor" aria-label="anchor" href="#set-up-the-fare-structure"></a>
</h4>
<p>Now we need to set what are the fare rules of our public transport system. These rules will be used by <code>R5</code> to calculate the monetary cost of alternative routes. In the case of Porto Alegre, the fare rules are as follows: * Each bus ticket costs R$ 4.80. * Riding a second bus adds <code>$</code> 2.40 to the total cost. Subsequent bus rides cost the full ticket price of $ 4.80. * Each train ticket costs $ 4.50. Once a passenger enters a train station, she can take an unlimited amount of train trips as long as she doesn’t leave a station. * The integrated fare between bus and train has a 10% discount, which totals $ 8.37.</p>
<p>We can create <code>list</code> object with these fare rules with the support of the <code><a href="../reference/setup_fare_structure.html">setup_fare_structure()</a></code> function as shown in the code below. A detailed explanation of how to use the fare structure of <code>5r5</code> can be found in <a href="https://ipeagit.github.io/r5r/articles/fare_structure.html" class="external-link">(this other vignette)</a>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># create basic fare structure</span>
<span class="va">fare_structure</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/setup_fare_structure.html">setup_fare_structure</a></span><span class="op">(</span><span class="va">r5r_core</span>, 
                                       base_fare <span class="op">=</span> <span class="fl">4.8</span>,
                                       by <span class="op">=</span> <span class="st">"MODE"</span><span class="op">)</span>

<span class="co"># update the cost of bus and train fares</span>
<span class="va">fare_structure</span><span class="op">$</span><span class="va">fares_per_mode</span><span class="op">[</span>, <span class="va">fare</span> <span class="op">:=</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/fcase.html" class="external-link">fcase</a></span><span class="op">(</span><span class="va">mode</span> <span class="op">==</span> <span class="st">"BUS"</span>, <span class="fl">4.80</span>,
                                             <span class="va">mode</span> <span class="op">==</span> <span class="st">"RAIL"</span>, <span class="fl">4.50</span><span class="op">)</span><span class="op">]</span>

<span class="co"># update the cost of tranfers</span>
<span class="va">fare_structure</span><span class="op">$</span><span class="va">fares_per_transfer</span><span class="op">[</span>, <span class="va">fare</span> <span class="op">:=</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/fcase.html" class="external-link">fcase</a></span><span class="op">(</span><span class="va">first_leg</span> <span class="op">==</span> <span class="st">"BUS"</span> <span class="op">&amp;</span> <span class="va">second_leg</span> <span class="op">==</span> <span class="st">"BUS"</span>, <span class="fl">7.2</span>,
                                                 <span class="va">first_leg</span> <span class="op">!=</span> <span class="va">second_leg</span>, <span class="fl">8.37</span><span class="op">)</span><span class="op">]</span>

<span class="co"># update transfer_time_allowance to 60 minutes</span>
<span class="va">fare_structure</span><span class="op">$</span><span class="va">transfer_time_allowance</span> <span class="op">&lt;-</span> <span class="fl">60</span>

<span class="va">fare_structure</span><span class="op">$</span><span class="va">fares_per_mode</span><span class="op">[</span><span class="va">mode</span> <span class="op">==</span> <span class="st">"RAIL"</span>, <span class="va">unlimited_transfers</span> <span class="op">:=</span> <span class="cn">TRUE</span><span class="op">]</span>
<span class="va">fare_structure</span><span class="op">$</span><span class="va">fares_per_mode</span><span class="op">[</span><span class="va">mode</span> <span class="op">==</span> <span class="st">"RAIL"</span>, <span class="va">allow_same_route_transfer</span> <span class="op">:=</span> <span class="cn">TRUE</span><span class="op">]</span></code></pre></div>
<p>For convenience, we can save these fare rules as a <code>zip</code> file and load again for a future application.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># save fare rules to temp file</span>
<span class="va">temp_fares</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"fares_poa"</span>, fileext <span class="op">=</span> <span class="st">".zip"</span><span class="op">)</span>
<span class="fu">r5r</span><span class="fu">::</span><span class="fu"><a href="../reference/write_fare_structure.html">write_fare_structure</a></span><span class="op">(</span><span class="va">fare_structure</span>, file_path <span class="op">=</span> <span class="va">temp_fares</span><span class="op">)</span>


<span class="va">fare_structure</span> <span class="op">&lt;-</span> <span class="fu">r5r</span><span class="fu">::</span><span class="fu"><a href="../reference/read_fare_structure.html">read_fare_structure</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">data_path</span>, <span class="st">"fares/fares_poa.zip"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="calculating-a-pareto_frontier-">3.3 Calculating a <code>pareto_frontier()</code>.<a class="anchor" aria-label="anchor" href="#calculating-a-pareto_frontier-"></a>
</h4>
<p>In this example, we calculate the Pareto frontier from all origins to all destinations considering multiple cutoffs of monetary costs: - $1, which would only allow for walking trips - $4.5, which would only allow for rail trips - $4.8, which would allow for a single bus trip - $7.20, which would allow for bus + bus - $8.37, which would allow for walking walking + bus + rail</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">departure_datetime</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html" class="external-link">as.POSIXct</a></span><span class="op">(</span><span class="st">"13-05-2019 14:00:00"</span>, format <span class="op">=</span> <span class="st">"%d-%m-%Y %H:%M:%S"</span><span class="op">)</span>

<span class="va">pf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pareto_frontier.html">pareto_frontier</a></span><span class="op">(</span><span class="va">r5r_core</span>,
                      origins <span class="op">=</span> <span class="va">points</span>,
                      destinations <span class="op">=</span> <span class="va">points</span>,
                      mode <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"WALK"</span>, <span class="st">"TRANSIT"</span><span class="op">)</span>,
                      departure_datetime <span class="op">=</span> <span class="va">departure_datetime</span>,
                      fare_structure <span class="op">=</span> <span class="va">fare_structure</span>,
                      monetary_cost_cutoffs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">4.5</span>, <span class="fl">4.8</span>, <span class="fl">7.20</span>, <span class="fl">8.37</span><span class="op">)</span>,
                      progress <span class="op">=</span> <span class="cn">TRUE</span>
                      <span class="op">)</span>
<span class="co">#&gt; Loading required namespace: testthat</span>
<span class="co">#&gt; Preparing final output... DONE!</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">pf</span><span class="op">)</span>
<span class="co">#&gt;          from_id               to_id percentile travel_time monetary_cost</span>
<span class="co">#&gt; 1: public_market       public_market         50           0           1.0</span>
<span class="co">#&gt; 2: public_market bus_central_station         50          23           1.0</span>
<span class="co">#&gt; 3: public_market bus_central_station         50          18           4.5</span>
<span class="co">#&gt; 4: public_market bus_central_station         50          13           4.8</span>
<span class="co">#&gt; 5: public_market    gasometer_museum         50          29           1.0</span>
<span class="co">#&gt; 6: public_market    gasometer_museum         50          15           4.8</span></code></pre></div>
<p>For the sake of illustration, let’s check the most optimum route alternatives from the Farrapos train station to (a) the Praia de Belas shopping mall and (b) the Moinhos hospital.</p>
<p>One cannot make a faster trip without increasing costs, one cannot make a cheaper trip without increasing travel time.</p>
<pre><code><span class="co">#&gt; Warning: Removed 4 rows containing missing values (geom_text).</span></code></pre>
<p><img src="pareto_frontier_files/figure-html/unnamed-chunk-7-1.png" width="672"></p>
</div>
</div>
<div class="section level3">
<h3 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h3>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Marcus Saraiva, Rafael H. M. Pereira, Daniel Herszenhut, Carlos Kaue Vieira Braga, Matthew Wigginton Conway, Ipea - Institute for Applied Economic Research.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.3.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
