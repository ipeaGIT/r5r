<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Calculate detailed itineraries between origin destination pairs — detailed_itineraries • r5r</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Calculate detailed itineraries between origin destination pairs — detailed_itineraries"><meta property="og:description" content="Fast computation of (multiple) detailed itineraries between one or many
origin destination pairs."><meta property="og:image" content="/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">r5r</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.7.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../articles/r5r.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/calculating_accessibility.html">Calculating and visualizing Accessibility</a>
    </li>
    <li>
      <a href="../articles/calculating_isochrones.html">Calculating and visualizing Isochrones</a>
    </li>
    <li>
      <a href="../articles/fare_calculator.html">Configuring and Using Fare Calculators</a>
    </li>
    <li>
      <a href="../articles/pareto_frontier.html">pareto_frontier() to analyze the trade-offs between travel time and monetary cost</a>
    </li>
    <li>
      <a href="../articles/time_window.html">Using the time_window parameter</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/ipeaGIT/r5r/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Calculate detailed itineraries between origin destination pairs</h1>
    <small class="dont-index">Source: <a href="https://github.com/ipeaGIT/r5r/tree/master/r-package/R/detailed_itineraries.R" class="external-link"><code>R/detailed_itineraries.R</code></a></small>
    <div class="hidden name"><code>detailed_itineraries.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Fast computation of (multiple) detailed itineraries between one or many
origin destination pairs.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">detailed_itineraries</span><span class="op">(</span>
  <span class="va">r5r_core</span>,
  <span class="va">origins</span>,
  <span class="va">destinations</span>,
  mode <span class="op">=</span> <span class="st">"WALK"</span>,
  mode_egress <span class="op">=</span> <span class="st">"WALK"</span>,
  departure_datetime <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span>,
  max_walk_dist <span class="op">=</span> <span class="cn">Inf</span>,
  max_bike_dist <span class="op">=</span> <span class="cn">Inf</span>,
  max_trip_duration <span class="op">=</span> <span class="fl">120L</span>,
  walk_speed <span class="op">=</span> <span class="fl">3.6</span>,
  bike_speed <span class="op">=</span> <span class="fl">12</span>,
  max_rides <span class="op">=</span> <span class="fl">3</span>,
  max_lts <span class="op">=</span> <span class="fl">2</span>,
  shortest_path <span class="op">=</span> <span class="cn">TRUE</span>,
  all_to_all <span class="op">=</span> <span class="cn">FALSE</span>,
  n_threads <span class="op">=</span> <span class="cn">Inf</span>,
  verbose <span class="op">=</span> <span class="cn">FALSE</span>,
  progress <span class="op">=</span> <span class="cn">FALSE</span>,
  drop_geometry <span class="op">=</span> <span class="cn">FALSE</span>
<span class="op">)</span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>r5r_core</dt>
<dd><p>An object to connect with the R5 routing engine, created with
<code><a href="setup_r5.html">setup_r5()</a></code>.</p></dd>
<dt>origins, destinations</dt>
<dd><p>Either a <code>POINT sf</code> object with WGS84 CRS, or a
<code>data.frame</code> containing the columns <code>id</code>, <code>lon</code> and <code>lat</code>.</p></dd>
<dt>mode</dt>
<dd><p>A character vector. The transport modes allowed for access,
transfer and vehicle legs of the trips. Defaults to <code>WALK</code>. Please see
details for other options.</p></dd>
<dt>mode_egress</dt>
<dd><p>A character vector. The transport mode used after egress
from the last public transport. It can be either <code>WALK</code>, <code>BICYCLE</code> or <code>CAR</code>.
Defaults to <code>WALK</code>. Ignored when public transport is not used.</p></dd>
<dt>departure_datetime</dt>
<dd><p>A POSIXct object. If working with public transport
networks, please check the <code>calendar.txt</code> within your GTFS feeds for valid
dates. Please see details for further information on how datetimes are
parsed.</p></dd>
<dt>max_walk_dist</dt>
<dd><p>An integer. The maximum walking distance (in meters) to
access and egress the transit network, or to make transfers within the
network. Defaults to no restrictions, as long as <code>max_trip_duration</code> is
respected. The max distance is considered separately for each leg (e.g. if
you set <code>max_walk_dist</code> to 1000, you could potentially walk up to 1 km to
reach transit, and up to <em>another</em> 1 km to reach the destination after
leaving transit). Please note that this parameter doesn't affect the maximum
length of walking-only trips, only walking access, egress and transfer legs.
If you want to set a maximum walking distance for walking-only trips you
have to use the <code>max_trip_duration</code> parameter (e.g. to set a walking-only
trip max distance of 1 km, assuming a walking speed of 3.6 km/h, you have to
set <code>max_trip_duration = 1 / 3.6 * 60</code>).</p></dd>
<dt>max_bike_dist</dt>
<dd><p>An integer. The maximum cycling distance (in meters) to
access and egress the transit network, or to make transfers within the
network. Defaults to no restrictions, as long as <code>max_trip_duration</code> is
respected. The max distance is considered separately for each leg (e.g. if
you set <code>max_bike_dist</code> to 1000, you could potentially cycle up to 1 km to
reach transit, and up to <em>another</em> 1 km to reach the destination after
leaving transit). Please note that this parameter doesn't affect the maximum
length of cycling-only trips, only cycling access, egress and transfer legs.
If you want to set a maximum cycling distance for cycling-only trips you
have to use the <code>max_trip_duration</code> parameter (e.g. to set a walking-only
trip max distance of 5 km, assuming a cycling speed of 12 km/h, you have to
set <code>max_trip_duration = 5 / 12 * 60</code>).</p></dd>
<dt>max_trip_duration</dt>
<dd><p>An integer. The maximum trip duration in minutes.
Defaults to 120 minutes (2 hours).</p></dd>
<dt>walk_speed</dt>
<dd><p>A numeric. Average walk speed in km/h. Defaults to 3.6
km/h.</p></dd>
<dt>bike_speed</dt>
<dd><p>A numeric. Average cycling speed in km/h. Defaults to 12
km/h.</p></dd>
<dt>max_rides</dt>
<dd><p>An integer. The maximum number of public transport rides
allowed in the same trip. Defaults to 3.</p></dd>
<dt>max_lts</dt>
<dd><p>An integer between 1 and 4. The maximum level of traffic
stress that cyclists will tolerate. A value of 1 means cyclists will only
travel through the quietest streets, while a value of 4 indicates cyclists
can travel through any road. Defaults to 2. Please see details for more
information.</p></dd>
<dt>shortest_path</dt>
<dd><p>A logical. Whether the function should only return the
fastest itinerary between each origin and destination pair (the default) or
multiple alternatives.</p></dd>
<dt>all_to_all</dt>
<dd><p>A logical. Whether to query routes between the 1st origin
to the 1st destination, then the 2nd origin to the 2nd destination, and so
on (<code>FALSE</code>, the default) or to query routes between all origins to all
destinations (<code>TRUE</code>).</p></dd>
<dt>n_threads</dt>
<dd><p>An integer. The number of threads to use when running the
router in parallel. Defaults to use all available threads (Inf).</p></dd>
<dt>verbose</dt>
<dd><p>A logical. Whether to show <code>R5</code> informative messages when
running the function. Defaults to <code>FALSE</code> (please note that in such case <code>R5</code>
error messages are still shown). Setting <code>verbose</code> to <code>TRUE</code> shows detailed
output, which can be useful for debugging issues not caught by <code>r5r</code>.</p></dd>
<dt>progress</dt>
<dd><p>A logical. Whether to show a progress counter when running
the router. Defaults to <code>FALSE</code>. Only works when <code>verbose</code> is set to <code>FALSE</code>,
so the progress counter does not interfere with <code>R5</code>'s output messages.
Setting <code>progress</code> to <code>TRUE</code> may impose a small penalty for computation
efficiency, because the progress counter must be synchronized among all
active threads.</p></dd>
<dt>drop_geometry</dt>
<dd><p>A logical. Whether the output should include the
geometry of each segment or not. The default value of <code>FALSE</code> keeps the
geometry column in the result.</p></dd>
</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>When <code>drop_geometry</code> is <code>FALSE</code>, the function outputs a <code>LINESTRING sf</code> with detailed information on the itineraries between the specified
origins and destinations. When <code>TRUE</code>, the output is a <code>data.table</code>. All
distances are in meters and travel times are in minutes.</p>
    </div>
    <div id="transport-modes">
    <h2>Transport modes</h2>
    


<p><code>R5</code> allows for multiple combinations of transport modes. The options
include:</p><ul><li><p><strong>Transit modes:</strong> <code>TRAM</code>, <code>SUBWAY</code>, <code>RAIL</code>, <code>BUS</code>, <code>FERRY</code>, <code>CABLE_CAR</code>,
<code>GONDOLA</code>, <code>FUNICULAR</code>. The option <code>TRANSIT</code> automatically considers all
public transport modes available.</p></li>
<li><p><strong>Non transit modes:</strong> <code>WALK</code>, <code>BICYCLE</code>, <code>CAR</code>, <code>BICYCLE_RENT</code>,
<code>CAR_PARK</code>.</p></li>
</ul></div>
    <div id="level-of-traffic-stress-lts-">
    <h2>Level of Traffic Stress (LTS)</h2>
    


<p>When cycling is enabled in <code>R5</code> (by passing the value <code>BIKE</code> to either
<code>mode</code> or <code>mode_egress</code>), setting <code>max_lts</code> will allow cycling only on
streets with a given level of danger/stress. Setting <code>max_lts</code> to 1, for
example, will allow cycling only on separated bicycle infrastructure or
low-traffic streets and routing will revert to walking when traversing any
links with LTS exceeding 1. Setting <code>max_lts</code> to 3 will allow cycling on
links with LTS 1, 2 or 3. Routing also reverts to walking if the street
segment is tagged as non-bikable in OSM (e.g. a staircase), independently of
the specified max LTS.</p>
<p>The default methodology for assigning LTS values to network edges is based
on commonly tagged attributes of OSM ways. See more info about LTS in the
original documentation of R5 from Conveyal at
<a href="https://docs.conveyal.com/learn-more/traffic-stress" class="external-link">https://docs.conveyal.com/learn-more/traffic-stress</a>. In summary:</p><ul><li><p><strong>LTS 1</strong>: Tolerable for children. This includes low-speed, low-volume
streets, as well as those with separated bicycle facilities (such as
parking-protected lanes or cycle tracks).</p></li>
<li><p><strong>LTS 2</strong>: Tolerable for the mainstream adult population. This includes
streets where cyclists have dedicated lanes and only have to interact with
traffic at formal crossing.</p></li>
<li><p><strong>LTS 3</strong>: Tolerable for â€œenthused and confidentâ€ cyclists. This includes
streets which may involve close proximity to moderate- or high-speed
vehicular traffic.</p></li>
<li><p><strong>LTS 4</strong>: Tolerable only for â€œstrong and fearlessâ€ cyclists. This
includes streets where cyclists are required to mix with moderate- to
high-speed vehicular traffic.</p></li>
</ul><p>For advanced users, you can provide custom LTS values by adding a tag <code>&lt;key = "lts"&gt;</code> to the <code>osm.pbf</code> file.</p>
    </div>
    <div id="datetime-parsing">
    <h2>Datetime parsing</h2>
    


<p><code>r5r</code> ignores the timezone attribute of datetime objects when parsing dates
and times, using the study area's timezone instead. For example, let's say
you are running some calculations using Rio de Janeiro, Brazil, as your study
area. The datetime <code>as.POSIXct("13-05-2019 14:00:00", format = "%d-%m-%Y %H:%M:%S")</code> will be parsed as May 13th, 2019, 14:00h in
Rio's local time, as expected. But <code>as.POSIXct("13-05-2019 14:00:00", format = "%d-%m-%Y %H:%M:%S", tz = "Europe/Paris")</code> will also be parsed as
the exact same date and time in Rio's local time, perhaps surprisingly,
ignoring the timezone attribute.</p>
    </div>
    <div id="routing-algorithm">
    <h2>Routing algorithm</h2>
    


<p>The <code>detailed_itineraries()</code> and <code><a href="pareto_frontier.html">pareto_frontier()</a></code> functions use an
<code>R5</code>-specific extension to the McRAPTOR routing algorithm. The
implementation used in <code>detailed_itineraries()</code> allows the router to find
paths that are optimal and less than optimal in terms of travel time, with
some heuristics around multiple access modes, riding the same patterns, etc.
The specific extension to McRAPTOR to do suboptimal path routing is not
documented yet, but a detailed description of base McRAPTOR can be found in
Delling et al (2015). The implementation used in <code><a href="pareto_frontier.html">pareto_frontier()</a></code>, on the
other hand, returns only the fastest trip within a given monetary cutoff,
ignoring slower trips that cost the same. A detailed discussion on the
algorithm can be found in Conway and Stewart (2019).</p><ul><li><p>Delling, D., Pajor, T., &amp; Werneck, R. F. (2015). Round-based public
transit routing. Transportation Science, 49(3), 591-604.
<a href="https://doi.org/10.1287/trsc.2014.0534" class="external-link">doi:10.1287/trsc.2014.0534</a></p></li>
<li><p>Conway, M. W., &amp; Stewart, A. F. (2019). Getting Charlie off the MTA: a
multiobjective optimization method to account for cost constraints in public
transit accessibility metrics. International Journal of Geographical
Information Science, 33(9), 1759â€“1787. <a href="https://doi.org/10.1080/13658816.2019.1605075" class="external-link">doi:10.1080/13658816.2019.1605075</a></p></li>
</ul></div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p>Other routing: 
<code><a href="accessibility.html">accessibility</a>()</code>,
<code><a href="pareto_frontier.html">pareto_frontier</a>()</code>,
<code><a href="travel_time_matrix.html">travel_time_matrix</a>()</code></p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># interactive()</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ipeaGIT/r5r" class="external-link">r5r</a></span><span class="op">)</span>

<span class="co"># build transport network</span>
<span class="va">data_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/poa"</span>, package <span class="op">=</span> <span class="st">"r5r"</span><span class="op">)</span>
<span class="va">r5r_core</span> <span class="op">&lt;-</span> <span class="fu"><a href="setup_r5.html">setup_r5</a></span><span class="op">(</span>data_path <span class="op">=</span> <span class="va">data_path</span>, temp_dir <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="co"># load origin/destination points</span>
<span class="va">points</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">data_path</span>, <span class="st">"poa_points_of_interest.csv"</span><span class="op">)</span><span class="op">)</span>

<span class="co"># inputs</span>
<span class="va">departure_datetime</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html" class="external-link">as.POSIXct</a></span><span class="op">(</span>
  <span class="st">"13-05-2019 14:00:00"</span>,
  format <span class="op">=</span> <span class="st">"%d-%m-%Y %H:%M:%S"</span>
<span class="op">)</span>

<span class="va">dit</span> <span class="op">&lt;-</span> <span class="fu">detailed_itineraries</span><span class="op">(</span><span class="va">r5r_core</span>,
                            origins <span class="op">=</span> <span class="va">points</span><span class="op">[</span><span class="fl">10</span>,<span class="op">]</span>,
                            destinations <span class="op">=</span> <span class="va">points</span><span class="op">[</span><span class="fl">12</span>,<span class="op">]</span>,
                            mode <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"WALK"</span>, <span class="st">"TRANSIT"</span><span class="op">)</span>,
                            departure_datetime <span class="op">=</span> <span class="va">departure_datetime</span>,
                            max_walk_dist <span class="op">=</span> <span class="fl">1000</span>,
                            max_trip_duration <span class="op">=</span> <span class="fl">120L</span><span class="op">)</span>

<span class="fu"><a href="stop_r5.html">stop_r5</a></span><span class="op">(</span><span class="va">r5r_core</span><span class="op">)</span>
<span class="op">}</span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Marcus Saraiva, Rafael H. M. Pereira, Rafael H. M. Pereira, Daniel Herszenhut, Carlos Kaue Vieira Braga, Matthew Wigginton Conway, Ipea - Institute for Applied Economic Research.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.3.</p>
</div>

      </footer></div>

  


  

  </body></html>

